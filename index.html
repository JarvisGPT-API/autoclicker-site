<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WOW</title>

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: radial-gradient(circle at top, #0b1a2a, #020617);
  color: white;
  text-align: center;
  touch-action: none;
}

#top {
  display: flex;
  justify-content: space-between;
  padding: 10px 20px;
}

#circle {
  position: relative;
  width: 260px;
  height: 260px;
  margin: 20px auto;
}

svg { position:absolute; inset:0; pointer-events:none; }

.letter {
  position:absolute;
  width:56px; height:56px;
  border-radius:50%;
  background:#2563eb;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  font-weight:bold;
}

.neon .letter {
  background:#a855f7;
  box-shadow:0 0 15px #a855f7;
}

.letter.active {
  background:#22c55e;
  transform:scale(1.15);
}

#current { font-size:28px; min-height:40px; }

#words {
  display:grid;
  gap:10px;
  justify-content:center;
}

.word { display:flex; gap:6px; }

.cell {
  width:34px; height:40px;
  border:2px solid rgba(255,255,255,.4);
  border-radius:6px;
  font-size:22px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.bonus .cell { border-color:#facc15; }

button {
  margin:6px;
  padding:10px 16px;
  border-radius:10px;
  border:none;
  background:#22c55e;
  color:white;
}

#shop {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  padding-top:100px;
}
</style>
</head>

<body>

<div id="top">
  <div>üí∞ <span id="coins">0</span></div>
  <div>–£—Ä. <span id="level">1</span></div>
</div>

<div id="current"></div>

<div id="circle"><svg id="lines"></svg></div>

<button onclick="hint()">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ (5üí∞)</button>
<button onclick="shuffleLetters()">üîÑ –ü–µ—Ä–µ–º–µ—à–∞—Ç—å</button>
<button onclick="openShop()">üõí –ú–∞–≥–∞–∑–∏–Ω</button>

<div id="words"></div>

<div id="shop">
  <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
  <button onclick="setSkin('default')">üîµ –°—Ç–∞–Ω–¥–∞—Ä—Ç</button><br>
  <button onclick="buyNeon()">üü£ –ù–µ–æ–Ω (20üí∞)</button><br><br>
  <button onclick="closeShop()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<script>
// ‚úÖ –¢–û–õ–¨–ö–û –°–õ–û–í–ê–†–ù–´–ï –°–õ–û–í–ê
const baseLevels = [
  { letters:["–ö","–û","–¢"], main:["–ö–û–¢"], bonus:["–¢–û–ö"] },
  { letters:["–î","–û","–ú"], main:["–î–û–ú"], bonus:["–ú–û–î"] },
  { letters:["–°","–û","–ö"], main:["–°–û–ö"], bonus:["–ö–û–°"] },
  { letters:["–õ","–ï","–°"], main:["–õ–ï–°"], bonus:[] },
  { letters:["–ú","–ò","–†"], main:["–ú–ò–†"], bonus:["–†–ò–ú"] },

  { letters:["–†","–£","–ö","–ê"], main:["–†–£–ö–ê"], bonus:["–ö–ê–†"] },
  { letters:["–°","–¢","–û","–õ"], main:["–°–¢–û–õ"], bonus:[] },
  { letters:["–ì","–û","–†","–ê"], main:["–ì–û–†–ê"], bonus:["–†–û–ì"] },
  { letters:["–ù","–û","–ì","–ê"], main:["–ù–û–ì–ê"], bonus:[] },
  { letters:["–¢","–ï","–õ","–û"], main:["–¢–ï–õ–û"], bonus:["–õ–ï–¢"] }
];

// 50 —É—Ä–æ–≤–Ω–µ–π
const levels=[];
while(levels.length<50){
  baseLevels.forEach(l=>{
    if(levels.length<50) levels.push(JSON.parse(JSON.stringify(l)));
  });
}

let level=+localStorage.level||0;
let coins=+localStorage.coins||0;
let skin=localStorage.skin||"default";

let current="",found=[],used=[],points=[],dragging=false;

const circle=document.getElementById("circle");
const svg=document.getElementById("lines");
const wordsDiv=document.getElementById("words");

document.getElementById("coins").textContent=coins;
document.body.className=skin==="neon"?"neon":"";

function save(){
  localStorage.level=level;
  localStorage.coins=coins;
  localStorage.skin=skin;
}

function loadLevel(){
  circle.querySelectorAll(".letter").forEach(e=>e.remove());
  wordsDiv.innerHTML="";
  svg.innerHTML="";
  current="";found=[];used=[];points=[];
  document.getElementById("level").textContent=level+1;

  const L=levels[level].letters;
  const r=100;

  L.forEach((l,i)=>{
    const a=2*Math.PI/L.length*i;
    const d=document.createElement("div");
    d.className="letter";
    d.textContent=l;
    d.style.left=130+r*Math.cos(a)-28+"px";
    d.style.top =130+r*Math.sin(a)-28+"px";
    circle.appendChild(d);
  });

  levels[level].main.forEach(w=>addWord(w,false));
  levels[level].bonus.forEach(w=>addWord(w,true));
}

function addWord(w,bonus){
  const row=document.createElement("div");
  row.className="word"+(bonus?" bonus":"");
  row.dataset.word=w;
  row.dataset.bonus=bonus;
  for(let i=0;i<w.length;i++)
    row.appendChild(document.createElement("div")).className="cell";
  wordsDiv.appendChild(row);
}

circle.onpointerdown=e=>{dragging=true;check(e);}
circle.onpointermove=e=>dragging&&check(e);
document.onpointerup=()=>{dragging=false;checkWord();reset();}

function check(e){
  document.querySelectorAll(".letter").forEach(el=>{
    if(used.includes(el))return;
    const r=el.getBoundingClientRect();
    if(Math.hypot(e.clientX-(r.left+r.width/2),e.clientY-(r.top+r.height/2))<30){
      used.push(el);
      el.classList.add("active");
      current+=el.textContent;
      points.push({x:r.left+r.width/2,y:r.top+r.height/2});
      draw();
      document.getElementById("current").textContent=current;
    }
  });
}

function draw(){
  svg.innerHTML="";
  for(let i=1;i<points.length;i++){
    svg.innerHTML+=`<line x1="${points[i-1].x-circle.offsetLeft}"
    y1="${points[i-1].y-circle.offsetTop}"
    x2="${points[i].x-circle.offsetLeft}"
    y2="${points[i].y-circle.offsetTop}"
    stroke="#22c55e" stroke-width="6" stroke-linecap="round"/>`;
  }
}

function reset(){
  document.querySelectorAll(".letter").forEach(l=>l.classList.remove("active"));
  svg.innerHTML="";used=[];points=[];current="";
  document.getElementById("current").textContent="";
}

function checkWord(){
  document.querySelectorAll(".word").forEach(r=>{
    if(r.dataset.word===current && !found.includes(current)){
      found.push(current);
      coins+=current.length*(r.dataset.bonus==="true"?2:1);
      document.getElementById("coins").textContent=coins;
      [...r.children].forEach((c,i)=>c.textContent=current[i]);
      save();
    }
  });

  if(levels[level].main.every(w=>found.includes(w))){
    level++; save(); setTimeout(loadLevel,600);
  }
}

function shuffleLetters(){
  const letters=[...document.querySelectorAll(".letter")];
  const pos=letters.map(l=>({l:l.style.left,t:l.style.top}));
  pos.sort(()=>Math.random()-0.5);
  letters.forEach((l,i)=>{l.style.left=pos[i].l; l.style.top=pos[i].t;});
  reset();
}

function hint(){
  if(coins<5)return;
  coins-=5; save();
  document.getElementById("coins").textContent=coins;
  const r=[...document.querySelectorAll(".word")]
    .find(r=>![...r.children].every(c=>c.textContent));
  if(!r)return;
  const i=[...r.children].findIndex(c=>!c.textContent);
  r.children[i].textContent=r.dataset.word[i];
}

function openShop(){shop.style.display="block";}
function closeShop(){shop.style.display="none";}
function buyNeon(){if(coins>=20){coins-=20;skin="neon";save();location.reload();}}
function setSkin(s){skin=s;save();location.reload();}

loadLevel();
</script>
</body>
</html>
